{"version":3,"sources":["PrototipoWeb/js/uploadDoc.js"],"names":["firebaseConfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","firebase","initializeApp","selectedFile","database","$","on","event","target","files","btnUploadDoc","document","querySelector","onclick","filename","name","uploadTask","storage","ref","put","snapshot","progress","bytesTransferred","totalBytes","console","log","state","TaskState","PAUSED","RUNNING","error","getDownloadURL","then","downloadURL","url","email","localStorage","getItem","alert","window","location","href","title","actualizar","getElementById","value","hours","description","hoursInt","parseInt","fecha","Date","banco","push","set","toLocaleDateString","referenciaUsuarios","once","snap","usuariosBdT","horasActuales","val","i","correo","spshot","horas","horasActualesInt","toString","update"],"mappings":";AAAA,IAAIA,EAAiB,CACjBC,OAAQ,0CACRC,WAAY,sCACZC,YAAa,6CACbC,UAAW,sBACXC,cAAe,kCACfC,kBAAmB,eACnBC,MAAO,4CACPC,cAAe,gBAGnBC,SAASC,cAAcV,GACvB,IACIW,EADEC,EAAWH,SAASG,WAG1BC,EAAE,SAASC,GAAG,SAAU,SAAUC,GAC9BJ,EAAeI,EAAMC,OAAOC,MAAM,KAItC,IAAMC,EAAeC,SAASC,cAAc,iBAC5CF,EAAaG,QAAU,WAEfC,IAAAA,EAAWX,EAAaY,KAGxBC,EAFaf,SAASgB,UAAUC,IAAI,gBAAkBJ,GAE9BK,IAAIhB,GAIhCa,EAAWV,GACP,gBACA,SAAUc,GAGFC,IAAAA,EACCD,EAASE,iBAAmBF,EAASG,WAAc,IAEhDH,OADRI,QAAQC,IAAI,aAAeJ,EAAW,UAC9BD,EAASM,OACRzB,KAAAA,SAASgB,QAAQU,UAAUC,OAC5BJ,QAAQC,IAAI,oBACZ,MACCxB,KAAAA,SAASgB,QAAQU,UAAUE,QAC5BL,QAAQC,IAAI,uBAIxB,SAAUK,KAGV,WAGId,EAAWI,SAASF,IACfa,iBACAC,KAAK,SAAUC,GACRC,IAAAA,EAAMD,EACVT,QAAQC,IAAI,MAAOS,GAGfC,IAAAA,EAAQC,aAAaC,QAAQ,SAE7BF,GADJX,QAAQC,IAAIU,GACE,MAAVA,GAA2B,OAAVA,EACjBG,MACI,8DAEJC,OAAOC,SAASC,KAAO,iBACpB,CACCC,IAqBAC,EArBAD,EAAQ/B,SAASiC,eAAe,aAAaC,MAC7CC,EAAQnC,SAASiC,eAAe,SAASC,MACzCE,EAAcpC,SAASiC,eAAe,aACrCC,MAEDG,EAAWC,SAASH,EAAO,IAC3BI,EAAQ,IAAIC,KAGhBC,MAAQhD,EAASc,IAAjB,cAEAkC,MAAMC,OAAOC,IAAI,CACbZ,MAAOA,EACPI,MAAOA,EACPC,YAAaA,EACbZ,MAAOA,EACPD,IAAKA,EACLgB,MAAOA,EAAMK,uBAGjBC,mBAAqBpD,EAASc,IAA9B,eAGAsC,mBAAmBC,KAAK,QAAS,SAACC,GACxBC,IASFC,EATED,EAAcD,EAAKG,MAEpB,IAAA,IAAMC,KAAKH,EACRA,EAAYG,GAAGC,SAAW5B,IAC1BQ,EAAavC,EAASc,IACH4C,eAAAA,OAAAA,KAK3BnB,EAAWc,KAAK,QAAS,SAACO,GACtBJ,EAAgBI,EAAOH,MAAMI,MAC7BC,iBAAmBjB,SAASW,EAAe,IAC3CM,kBAAoBlB,EACpBY,EAAgBM,iBAAiBC,SAAS,IAE1CxB,EAAWyB,OAAO,CACdH,MAAOL,IAEXrB,OAAOC,SAASC,KAAO","file":"uploadDoc.a9001052.js","sourceRoot":"..","sourcesContent":["var firebaseConfig = {\n    apiKey: \"AIzaSyAYC2xOKqPvMKbQWxXxiQHpW3HbbDdCou0\",\n    authDomain: \"introfirebase-e7ca2.firebaseapp.com\",\n    databaseURL: \"https://introfirebase-e7ca2.firebaseio.com\",\n    projectId: \"introfirebase-e7ca2\",\n    storageBucket: \"introfirebase-e7ca2.appspot.com\",\n    messagingSenderId: \"660691288615\",\n    appId: \"1:660691288615:web:3c97023e6eeab131560402\",\n    measurementId: \"G-S3377XEK4R\",\n};\n// Initialize Firebase\nfirebase.initializeApp(firebaseConfig);\nconst database = firebase.database();\nlet selectedFile;\n\n$(\"#file\").on(\"change\", function (event) {\n    selectedFile = event.target.files[0];\n});\n\n// Subir oferta\nconst btnUploadDoc = document.querySelector(\"#btnUploadDoc\");\nbtnUploadDoc.onclick = () => {\n    // Create a root reference\n    let filename = selectedFile.name;\n    let storageRef = firebase.storage().ref(\"/trabajosBdT/\" + filename);\n\n    let uploadTask = storageRef.put(selectedFile);\n\n    // Observers:\n\n    uploadTask.on(\n        \"state_changed\",\n        function (snapshot) {\n            // Observe state change events such as progress, pause, and resume\n            // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded\n            var progress =\n                (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\n            console.log(\"Upload is \" + progress + \"% done\");\n            switch (snapshot.state) {\n                case firebase.storage.TaskState.PAUSED: // or 'paused'\n                    console.log(\"Upload is paused\");\n                    break;\n                case firebase.storage.TaskState.RUNNING: // or 'running'\n                    console.log(\"Upload is running\");\n                    break;\n            }\n        },\n        function (error) {\n            // Handle unsuccessful uploads\n        },\n        function () {\n            // Handle successful uploads on complete\n            // For instance, get the download URL: https://firebasestorage.googleapis.com/...\n            uploadTask.snapshot.ref\n                .getDownloadURL()\n                .then(function (downloadURL) {\n                    let url = downloadURL;\n                    console.log(\"URL\", url);\n\n                    //Enviar todo.\n                    let email = localStorage.getItem(\"email\");\n                    console.log(email);\n                    if (email === \" \" || email === null) {\n                        alert(\n                            \"No ha iniciado sesión. Se le redirigirá a 'Iniciar Sesión'\"\n                        );\n                        window.location.href = \"login.html\";\n                    } else {\n                        let title = document.getElementById(\"title_doc\").value;\n                        let hours = document.getElementById(\"hours\").value;\n                        let description = document.getElementById(\"textarea1\")\n                            .value;\n\n                        let hoursInt = parseInt(hours, 10); // pasar a entero en base 10\n                        let fecha = new Date();\n                        // console.log(fecha.toLocaleDateString());\n\n                        banco = database.ref(`ofertasBdT`);\n\n                        banco.push().set({\n                            title: title,\n                            hours: hours,\n                            description: description,\n                            email: email,\n                            url: url,\n                            fecha: fecha.toLocaleDateString(),\n                        });\n\n                        referenciaUsuarios = database.ref(`usuariosBdT`);\n                        let actualizar;\n\n                        referenciaUsuarios.once(\"value\", (snap) => {\n                            const usuariosBdT = snap.val();\n\n                            for (const i in usuariosBdT) {\n                                if (usuariosBdT[i].correo === email) {\n                                    actualizar = database.ref(\n                                        `usuariosBdT/${i}`\n                                    );\n                                }\n                            }\n                            let horasActuales;\n                            actualizar.once(\"value\", (spshot) => {\n                                horasActuales = spshot.val().horas;\n                                horasActualesInt = parseInt(horasActuales, 10);\n                                horasActualesInt += hoursInt;\n                                horasActuales = horasActualesInt.toString(10);\n\n                                actualizar.update({\n                                    horas: horasActuales,\n                                });\n                                window.location.href = \"bancodetiempo.html\";\n                            });\n                        });\n                    }\n                });\n        }\n    );\n};\n"]}